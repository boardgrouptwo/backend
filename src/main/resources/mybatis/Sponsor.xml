<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.khcare.spring">
    <insert id="sponsorFormInsert" parameterType="map">
        INSERT INTO sponsor
            (user_id, spon_number ,spon_date, spon_huwon, spon_money, spon_pay, spon_open, spon_content) VALUES
            (#{user_id}, #{spon_number}, #{spon_date}, #{spon_huwon}, #{spon_money}, #{spon_pay}, #{spon_open}, #{spon_content})
    </insert>

    <select id="sponsorList" parameterType="map" resultType="map">
        SELECT user_id,
               SUM(spon_money) AS spon_money,
               (SELECT spon_content
                FROM sponsor
                WHERE user_id = A.user_id
                ORDER BY spon_date DESC
                                  LIMIT 1) AS spon_content,
                   CASE
                     WHEN EXISTS (SELECT 1 FROM sponsor WHERE user_id = A.user_id AND spon_open = '공개') THEN '공개'
                     ELSE '비공개'
                    END AS spon_open
        FROM sponsor A
        GROUP BY user_id
        ORDER BY spon_money DESC;
    </select>
</mapper>